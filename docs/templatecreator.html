<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Template Creator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: 2em auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #dadada; padding: 2em; }
    h1 { margin-top: 0; }
    .mode-switch { display: flex; gap: 1em; margin-bottom: 2em; }
    .mode-btn {
      border: none;
      background: #eee;
      color: #333;
      padding: 0.6em 2em;
      border-radius: 4px;
      font-size: 1.1em;
      cursor: pointer;
      font-weight: bold;
      transition: background .2s, color .2s;
    }
    .mode-btn.active-aura {
      background: #44c678;
      color: #fff;
    }
    .mode-btn.active-terra {
      background: #3286ff;
      color: #fff;
    }
    .form-section { margin-bottom: 2em; }
    label { display: block; margin-bottom: 0.4em; font-weight: bold; }
    input, textarea, select { width: 100%; padding: 0.5em; margin-bottom: 1em; border-radius: 4px; border: 1px solid #ccc; font-size: 1em; }
    .fields-list, .sections-list { margin-bottom: 1em; }
    .field-card, .section-card {
      background: #f2f2f2;
      border-radius: 4px;
      padding: 1em;
      margin-bottom: 1em;
      border: 1px solid #e0e0e0;
    }
    .field-actions, .section-actions { display: flex; gap: 0.5em; margin-top: 0.5em; }
    .action-btn {
      background: #eee; border: none; border-radius: 3px;
      font-weight: bold; cursor: pointer; padding: 0.3em 1.2em; transition: background .2s;
    }
    .action-btn:hover { background: #d2f0e0; }
    .delete-btn { background: #e44; color: #fff; }
    .delete-btn:hover { background: #b22; }
    .add-btn { margin-top: 1em; background: #44c678; color: #fff; }
    .add-btn:hover { background: #2a9c5d; }
    .submit-btn {
      background: #3286ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1.1em;
      font-weight: bold;
      padding: 0.8em 2.5em;
      cursor: pointer;
      transition: background .2s;
    }
    .submit-btn:hover { background: #2462b3; }
    .status { margin: 0.5em 0; color: #c44; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Template Creator</h1>
    <div class="mode-switch">
      <button id="aura-btn" class="mode-btn active-aura">Aura</button>
      <button id="terra-btn" class="mode-btn">Terra</button>
    </div>

    <form id="template-form">
      <!-- COMMON FIELDS -->
      <div class="form-section">
        <label for="template-label">Template Label</label>
        <input type="text" id="template-label" required>
        <label for="template-key">Template Key</label>
        <input type="text" id="template-key" required>
      </div>

      <!-- AURA MODE -->
      <div id="aura-section">
        <div class="fields-list" id="aura-fields-list"></div>
        <button type="button" class="add-btn" id="add-aura-field">+ Add Aura Field</button>
        <div class="form-section">
          <label for="aura-links">Links (optional, comma separated URLs)</label>
          <input type="text" id="aura-links">
        </div>
      </div>

      <!-- TERRA MODE -->
      <div id="terra-section" style="display:none;">
        <div class="sections-list" id="terra-sections-list"></div>
        <button type="button" class="add-btn" id="add-terra-section">+ Add Terra Section</button>
        <div class="form-section">
          <label for="terra-version">Version</label>
          <input type="text" id="terra-version" required>
        </div>
      </div>

      <button type="submit" class="submit-btn">Create Template</button>
      <div class="status" id="status"></div>
    </form>
  </div>

  <script>
    // --- Mode Switching ---
    let mode = 'aura';

    const auraBtn = document.getElementById('aura-btn');
    const terraBtn = document.getElementById('terra-btn');
    const auraSection = document.getElementById('aura-section');
    const terraSection = document.getElementById('terra-section');

    auraBtn.onclick = () => setMode('aura');
    terraBtn.onclick = () => setMode('terra');

    function setMode(newMode) {
      mode = newMode;
      if (mode === 'aura') {
        auraBtn.classList.add('active-aura');
        auraBtn.classList.remove('active-terra');
        terraBtn.classList.remove('active-terra');
        terraBtn.classList.remove('active-aura');
        terraSection.style.display = 'none';
        auraSection.style.display = '';
      } else {
        terraBtn.classList.add('active-terra');
        terraBtn.classList.remove('active-aura');
        auraBtn.classList.remove('active-terra');
        auraBtn.classList.remove('active-aura');
        auraSection.style.display = 'none';
        terraSection.style.display = '';
      }
    }

    // --- AURA FIELDS LOGIC ---
    let auraFields = [];

    function renderAuraFields() {
      const list = document.getElementById('aura-fields-list');
      list.innerHTML = '';
      auraFields.forEach((f, idx) => {
        const card = document.createElement('div');
        card.className = 'field-card';
        card.innerHTML = `
          <label>Field Label</label>
          <input type="text" value="${f.label || ''}" onchange="this.value && (auraFields[${idx}].label = this.value)">
          <label>Type</label>
          <select onchange="auraFields[${idx}].type = this.value">
            <option value="text" ${f.type === 'text' ? 'selected' : ''}>Text</option>
            <option value="number" ${f.type === 'number' ? 'selected' : ''}>Number</option>
            <option value="dropdown" ${f.type === 'dropdown' ? 'selected' : ''}>Dropdown</option>
          </select>
          <div id="aura-options-${idx}" style="display:${f.type === 'dropdown' ? 'block' : 'none'};">
            <label>Dropdown Options (comma separated)</label>
            <input type="text" value="${f.options ? f.options.join(',') : ''}" 
              onchange="auraFields[${idx}].options = this.value.split(',').map(x => x.trim()).filter(Boolean)">
          </div>
          <div class="field-actions">
            <button type="button" class="delete-btn action-btn" onclick="removeAuraField(${idx})">Delete Field</button>
          </div>
        `;
        // Attach dropdown show/hide on field type change
        setTimeout(() => {
          const sel = card.querySelector('select');
          sel.onchange = function() {
            auraFields[idx].type = this.value;
            renderAuraFields();
          };
        }, 0);
        list.appendChild(card);
      });
    }

    window.removeAuraField = function(idx) {
      auraFields.splice(idx, 1);
      renderAuraFields();
    };

    document.getElementById('add-aura-field').onclick = function() {
      auraFields.push({ label: '', type: 'text' });
      renderAuraFields();
    };

    // --- TERRA SECTIONS LOGIC ---
    let terraSections = [];

    function renderTerraSections() {
      const list = document.getElementById('terra-sections-list');
      list.innerHTML = '';
      terraSections.forEach((s, sidx) => {
        const card = document.createElement('div');
        card.className = 'section-card';
        card.innerHTML = `
          <label>Section Name</label>
          <input type="text" value="${s.name || ''}" onchange="terraSections[${sidx}].name = this.value">
          <label>Section Type</label>
          <input type="text" value="${s.type || ''}" onchange="terraSections[${sidx}].type = this.value">
          <label>Undeletable</label>
          <select onchange="terraSections[${sidx}].undeletable = (this.value === 'true')">
            <option value="true" ${s.undeletable ? 'selected' : ''}>True</option>
            <option value="false" ${!s.undeletable ? 'selected' : ''}>False</option>
          </select>
          <div class="fields-list" id="terra-fields-list-${sidx}"></div>
          <button type="button" class="add-btn" onclick="addTerraField(${sidx})">+ Add Field</button>
          <div class="section-actions">
            <button type="button" class="delete-btn action-btn" onclick="removeTerraSection(${sidx})">Delete Section</button>
          </div>
        `;
        list.appendChild(card);
        renderTerraFields(sidx);
      });
    }

    function renderTerraFields(sidx) {
      const section = terraSections[sidx];
      const list = document.getElementById(`terra-fields-list-${sidx}`);
      list.innerHTML = '';
      section.fields.forEach((f, fidx) => {
        const div = document.createElement('div');
        div.className = 'field-card';
        div.innerHTML = `
          <label>Field Name</label>
          <input type="text" value="${f.name || ''}" onchange="terraSections[${sidx}].fields[${fidx}].name = this.value">
          <label>Type</label>
          <input type="text" value="${f.type || ''}" onchange="terraSections[${sidx}].fields[${fidx}].type = this.value">
          <label>Static</label>
          <select onchange="terraSections[${sidx}].fields[${fidx}].static = (this.value === 'true')">
            <option value="true" ${f.static ? 'selected' : ''}>True</option>
            <option value="false" ${!f.static ? 'selected' : ''}>False</option>
          </select>
          <label>Required</label>
          <select onchange="terraSections[${sidx}].fields[${fidx}].required = (this.value === 'true')">
            <option value="true" ${f.required ? 'selected' : ''}>True</option>
            <option value="false" ${!f.required ? 'selected' : ''}>False</option>
          </select>
          <div class="field-actions">
            <button type="button" class="delete-btn action-btn" onclick="removeTerraField(${sidx},${fidx})">Delete Field</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    window.addTerraField = function(sidx) {
      terraSections[sidx].fields.push({ name: '', type: '', static: false, required: false });
      renderTerraSections();
    };

    window.removeTerraField = function(sidx, fidx) {
      terraSections[sidx].fields.splice(fidx, 1);
      renderTerraSections();
    };

    window.removeTerraSection = function(sidx) {
      terraSections.splice(sidx, 1);
      renderTerraSections();
    };

    document.getElementById('add-terra-section').onclick = function() {
      terraSections.push({ name: '', type: '', undeletable: false, fields: [] });
      renderTerraSections();
    };

    // --- FORM SUBMISSION ---
    document.getElementById('template-form').onsubmit = function(e) {
      e.preventDefault();
      document.getElementById('status').textContent = '';
      const label = document.getElementById('template-label').value.trim();
      const key = document.getElementById('template-key').value.trim();

      if (!label || !key) {
        document.getElementById('status').textContent = 'Label and Key are required.';
        return;
      }

      if (mode === 'aura') {
        if (auraFields.length === 0) {
          document.getElementById('status').textContent = 'Add at least one field for Aura template.';
          return;
        }
        // Validate aura fields
        for (let i = 0; i < auraFields.length; i++) {
          const f = auraFields[i];
          if (!f.label || !f.type) {
            document.getElementById('status').textContent = `Aura field #${i+1} is incomplete.`;
            return;
          }
          if (f.type === 'dropdown' && (!f.options || !Array.isArray(f.options) || f.options.length === 0)) {
            document.getElementById('status').textContent = `Aura field #${i+1} must have dropdown options.`;
            return;
          }
        }
        // Build Aura template object
        const links = document.getElementById('aura-links').value.split(',').map(x => x.trim()).filter(Boolean);
        const template = {
          type: 'aura',
          label,
          key,
          fields: auraFields.map(f => ({
            label: f.label,
            type: f.type,
            ...(f.type === 'dropdown' ? { options: f.options } : {})
          })),
          ...(links.length > 0 ? { links } : {})
        };
        // Here you can POST or save the template object
        document.getElementById('status').textContent = 'Aura template generated! (Not yet saved)';
        console.log('Aura Template:', template);
      } else {
        if (terraSections.length === 0) {
          document.getElementById('status').textContent = 'Add at least one section for Terra template.';
          return;
        }
        for (let s = 0; s < terraSections.length; s++) {
          const sec = terraSections[s];
          if (!sec.name || !sec.type || typeof sec.undeletable !== 'boolean') {
            document.getElementById('status').textContent = `Terra section #${s+1} is incomplete.`;
            return;
          }
          if (!Array.isArray(sec.fields) || sec.fields.length === 0) {
            document.getElementById('status').textContent = `Terra section #${s+1} must have at least one field.`;
            return;
          }
          for (let f = 0; f < sec.fields.length; f++) {
            const fld = sec.fields[f];
            if (!fld.name || !fld.type || typeof fld.static !== 'boolean' || typeof fld.required !== 'boolean') {
              document.getElementById('status').textContent = `Field #${f+1} in section #${s+1} is incomplete.`;
              return;
            }
          }
        }
        const version = document.getElementById('terra-version').value.trim();
        if (!version) {
          document.getElementById('status').textContent = 'Version is required for Terra template.';
          return;
        }
        // Build Terra template object
        const template = {
          type: 'terra',
          label,
          key,
          version,
          sections: terraSections.map(sec => ({
            name: sec.name,
            type: sec.type,
            undeletable: sec.undeletable,
            fields: sec.fields.map(fld => ({
              name: fld.name,
              type: fld.type,
              static: fld.static,
              required: fld.required
            }))
          }))
        };
        // Here you can POST or save the template object
        document.getElementById('status').textContent = 'Terra template generated! (Not yet saved)';
        console.log('Terra Template:', template);
      }
    };

    // --- Initialize ---
    setMode('aura');
    renderAuraFields();
    renderTerraSections();
  </script>
</body>
</html>
