<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Template (Tether)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <style>
    body { background: #f7f8fa; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
    #main { max-width: 800px; margin: 2em auto; background: #fff; padding: 2em 2em 3em 2em; border-radius: 16px; box-shadow: 0 4px 16px #e0e4eb; }
    .step-title { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; }
    .help-text { color: #666; margin-bottom: 1em; font-size: 1em; }
    .input-block { padding: 1.5em; background: #f2f6fa; border-radius: 12px; margin-bottom: 2em; box-shadow: 0 2px 7px #e4e8ef; }
    input, select, textarea { font-size: 1.1em; padding: 0.7em; border-radius: 6px; border: 1px solid #ccc; width: 100%; margin-bottom: 1em; box-sizing: border-box; }
    button { background: #2b90ff; color: #fff; border: none; border-radius: 6px; padding: 0.7em 1.5em; font-size: 1.1em; cursor: pointer; margin-right: 0.7em; margin-top: 0.3em; box-shadow: 0 2px 6px #d8e6f9; transition: background 0.2s; }
    button:disabled { background: #bbb; cursor: not-allowed; }
    button:hover:not(:disabled) { background: #176fd2; }
    .card { background: #f0f4fa; border-radius: 16px; margin-bottom: 2em; padding: 1.5em 1.2em; box-shadow: 0 2px 12px #e0e4eb; position: relative; }
    .section-title { font-weight: bold; font-size: 1.18em; margin-bottom: 0.3em; color: #2b90ff; letter-spacing: 0.02em;}
    .section-desc { color: #666; margin-bottom: 1em; font-size: 1em; }
    .section-actions { position: absolute; top: 1em; right: 1em; display: flex; gap: 0.2em; }
    .field-list { margin-top: 0.8em; margin-bottom: 0.8em; display: flex; flex-direction: column; gap: 1em;}
    .field-pill { background: #fff; border-radius: 14px; padding: 1em 1.2em; margin-bottom: 0.4em; box-shadow: 0 1px 6px #e0e4eb; border-left: 6px solid #2b90ff; min-width: 180px; position: relative; display: flex; flex-direction: column; gap: 0.4em;}
    .field-label { font-weight: bold; font-size: 1.08em; color: #222; margin-bottom: 0.2em;}
    .field-type-badge { background: #e4e8ef; color: #2b90ff; border-radius: 8px; padding: 0.2em 0.7em; font-size: 0.93em; margin-left: 0.4em; display: inline-block;}
    .static-badge { background: #27ae60; color: #fff; border-radius: 6px; padding: 0.2em 0.7em; font-size: 0.95em; margin-left: 0.5em;}
    .dynamic-badge { background: #2b90ff; color: #fff; border-radius: 6px; padding: 0.2em 0.7em; font-size: 0.95em; margin-left: 0.5em;}
    .required-badge { background: #27ae60; color: #fff; border-radius: 6px; padding: 0.15em 0.7em; font-size: 0.92em; margin-left: 0.5em;}
    .options-badge { background: #f39c12; color: #fff; border-radius: 6px; padding: 0.15em 0.7em; font-size: 0.92em; margin-left: 0.5em;}
    .description { color: #666; font-size: 0.98em; margin-bottom: 0.3em;}
    .remove-btn, .edit-btn { background: #e74c3c; color: #fff; border: none; border-radius: 6px; padding: 0.4em 1em; font-size: 0.95em; cursor: pointer; margin-left: 0.7em; margin-top: 0.3em; }
    .remove-btn:hover, .edit-btn:hover { background: #c0392b; }
    .indented-add-field-btn { background: #2b90ff; color: #fff; margin: 0.7em 0 0 2em; display: block; width: fit-content; }
    .indented-add-field-btn:hover { background: #176fd2; }
    .edit-field-btn { background: #f39c12; color: #fff; border: none; border-radius: 6px; padding: 0.4em 1em; font-size: 0.95em; cursor: pointer; margin-left: 0.6em; margin-top: 0.3em; }
    .edit-field-btn:hover { background: #c87c09; }
    .preview-block { background: #effbe0; border-radius: 16px; padding: 2em; margin-top: 2em; box-shadow: 0 2px 12px #cde6b6; }
    .error-message { color: #e74c3c; margin-bottom: 1em; font-weight: bold; }
    .success-message { color: #27ae60; margin-top: 1em; font-weight: bold; font-size: 1.1em; }
    .inline-field-form { background: #fff; border-radius: 8px; padding: 1em; margin-bottom: 0.7em; box-shadow: 0 1px 5px #e0e4eb; border-left: 4px solid #2b90ff; }
    .edit-section-form { background: #fff; border-radius: 8px; padding: 1em; margin-bottom: 0.7em; box-shadow: 0 1px 5px #e0e4eb; border-left: 4px solid #f39c12; }
    .toggle-btn { border: none; border-radius: 6px; padding: 0.5em 1.2em; font-size: 1em; cursor: pointer; margin-right: 1em; transition: background 0.2s, color 0.2s; }
    .toggle-yes { background: #27ae60; color: #fff; }
    .toggle-no { background: #e74c3c; color: #fff; }
    .after-save-btns { margin-top: 2em; display: flex; gap: 1em; }
    .modal-bg { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4); z-index:9999; display:flex; justify-content:center; align-items:center;}
    .modal { background:#fff; border-radius:12px; padding:2em 2em; box-shadow:0 2px 12px #bbb; font-size:1.1em; }
    .modal button { margin:1em 0.5em 0 0; }
    .template-label-display { display:flex; align-items:center; gap:1em; margin-bottom:1em; }
    #edit-template-label-btn { font-size:1em; padding:0.4em 1em; background:#f39c12; color:#fff; border:none; border-radius:6px; margin-left:0.5em; cursor:pointer;}
    #edit-template-label-btn:hover { background:#c87c09; }
    #edit-template-label-form { display:flex; align-items:center; gap:0.5em; margin-bottom:1em;}
    #edit-template-label-input { font-size:1.2em; padding:0.3em 0.6em;}
    #save-template-label-btn { font-size:1em; padding:0.4em 1em; background:#27ae60; color:#fff; border:none; border-radius:6px; margin-left:0.5em; cursor:pointer;}
    #save-template-label-btn:hover { background:#1a7342; }
    #cancel-template-label-btn { font-size:1em; padding:0.4em 1em; background:#e74c3c; color:#fff; border:none; border-radius:6px; margin-left:0.5em; cursor:pointer;}
    #cancel-template-label-btn:hover { background:#c0392b; }
    @media (max-width: 700px) { #main { padding: 1em; } .input-block, .card, .preview-block { padding: 1em; } .section-actions { position: static; margin-top:0.7em; } .indented-add-field-btn { margin-left: 0; } .after-save-btns { flex-direction: column; gap: 0.5em; } }
  </style>
</head>
<body>
<div id="main">
  <!-- STEP 1: NAME -->
  <div id="step-name" class="input-block">
    <div class="step-title">Create a New Template</div>
    <div class="help-text">Start by naming your template.<br><span style="color:#999;">(Example: Car Maintenance Log)</span></div>
    <input type="text" id="template-name" required placeholder="Template Name">
    <button id="start-btn">Next</button>
    <div id="name-error" class="error-message"></div>
  </div>
  <!-- STEP 2: SECTIONS + FIELDS -->
  <div id="builder-area" style="display:none;">
    <div class="template-label-display" id="template-label-display" style="display:none;">
      <span id="template-label-text" style="font-size:1.4em; font-weight:700; color:#2b90ff;"></span>
      <button id="edit-template-label-btn" title="Edit template name">Edit Name</button>
    </div>
    <form id="edit-template-label-form" style="display:none;">
      <input type="text" id="edit-template-label-input" required>
      <button id="save-template-label-btn" type="submit">Save</button>
      <button id="cancel-template-label-btn" type="button">Cancel</button>
      <span id="edit-template-label-error" class="error-message"></span>
    </form>
    <div class="step-title" style="margin-bottom:1.2em;">Build your template</div>
    <div class="help-text">First section is for static details (e.g., Car Details). You must add at least one static field before continuing.</div>
    <div id="sections-list"></div>
    <div id="add-section-wrap"></div>
    <button id="preview-btn" style="float:right;">Preview</button>
    <div style="clear:both;"></div>
    <div id="section-error" class="error-message"></div>
  </div>
  <!-- PREVIEW & SAVE -->
  <div id="step-preview" class="preview-block" style="display:none;">
    <div class="step-title">Preview your Template</div>
    <div id="preview-content"></div>
    <div id="after-save-btns" class="after-save-btns" style="display:none;">
      <button id="create-another-btn">Create Another Template</button>
      <button id="admin-btn">Go to Admin Page</button>
    </div>
    <button id="save-template-btn" style="margin-top:2em;">Save</button>
    <div id="save-status" class="success-message"></div>
    <button id="edit-btn" style="margin-top:2em;">Go Back & Edit</button>
  </div>
</div>
<!-- Modal for overwrite warning -->
<div id="modal-bg" class="modal-bg" style="display:none;">
  <div class="modal" id="modal-content">
    <div id="modal-message"></div>
    <button id="modal-confirm-btn">Yes, Overwrite</button>
    <button id="modal-cancel-btn">Cancel</button>
  </div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAZoL7FPJ8wBqz_sX81Fo5eKXpsOVrLUZ0",
  authDomain: "tether-71e0c.firebaseapp.com",
  databaseURL: "https://tether-71e0c-default-rtdb.firebaseio.com",
  projectId: "tether-71e0c",
  storageBucket: "tether-71e0c.appspot.com",
  messagingSenderId: "277809008742",
  appId: "1:277809008742:web:2586a2b821d8da8f969da7",
  measurementId: "G-X7ZQ6DJYEN"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ...rest of your code remains unchanged...

document.getElementById("admin-btn").onclick = function() {
  window.location.href = "/connect/admin.html";
};

function showModal(message) {
  document.getElementById("modal-message").textContent = message;
  document.getElementById("modal-bg").style.display = "flex";
}
function hideModal() {
  document.getElementById("modal-bg").style.display = "none";
}
</script>
</body>
</html>
