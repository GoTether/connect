<script type="module">
  import { database } from './firebase-init.js';
  import { ref, get } from "firebase/database";

  // Utility to get query params
  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  window.addEventListener('DOMContentLoaded', async () => {
    const id = getQueryParam('id');
    const welcomeDiv = document.getElementById('welcome');

    if (!id) {
      // Show welcome message, do not redirect
      welcomeDiv.style.display = 'block';
      return;
    }

    // Hide welcome message
    if (welcomeDiv) welcomeDiv.style.display = 'none';

    // Check Firebase for tethers/{id}
    try {
      const tetherRef = ref(database, `tethers/${id}`);
      const snapshot = await get(tetherRef);
      // Always redirect to display.html?id=... regardless of existence
      window.location.href = `display.html?id=${encodeURIComponent(id)}`;
    } catch (error) {
      // Show error message
      welcomeDiv.innerHTML = `<h2>Error</h2>
        <p>There was an error loading the tether: ${error.message}</p>
        <p><a href="index.html">Return to Home</a></p>`;
      welcomeDiv.style.display = 'block';
    }
  });
</script>
